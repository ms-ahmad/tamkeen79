{% extends 'tbase.html' %}
{% comment %} {% load static %} {% endcomment %}

{% block title %} مكتبة ودار تمكين للنشر -سلة المشتريات {% endblock title %}



{% block content %}

  <body id="top">


    <!-- begin:content -->
    
    <div id="content" >
      <div class="container" style=" padding-top: 11px";>
        <div class="row">
          <!-- begin:article -->

          <div class="col-md-9 col-md-push-3 m-push-cart">
            <div class="row">
              <div class="col-md-12 single-post single-cart">
                <div id="myTabContent" class="tab-content cart-page">
                  <div class="tab-pane fade in active cart-page" id="detail">
                    <div class="row">
                      <div class="col-md-12 col-cart">

                          <h2 >سلة المشتريات</h2>
                                                    <h3 style="margin-top: 36px; background-color: #eee; padding: 5px 26px; border-bottom: 1px solid #777;">معلومات الطلب</h3>

                              {% if order %}
    
                                <div class="card border-success mb-1">
                                    <form action="{% url 'orders:confirm_cart' %}" method="GET">
                                        <div class="col-md-6 col-lg-4 col-sm-12">

                                              <label for="username">اسم صاحب الطلب: </label>                                         
                                              <input type="tel"  value="{{ order.user.username  }}" readonly  name="username" id="username" class="form-control " placeholder="رقم الهاتف">
                                     
                                        </div>
                                        <div class="col-md-6 col-lg-4 col-sm-12">
                                                  <label for="date">التاريخ: </label>
                                                  <input type="tel"  value="{{ order.order_date |date:"d /m/ Y" }}"  readonly  name="date" id="date" class="form-control " placeholder="رقم الهاتف">

                                        </div>
                                        <div class="col-md-6 col-lg-4 col-sm-12">
                                              <label for="phone">الهاتف</label>
                                              <input type="tel" {% if order.phone  %} value="{{ order.phone }}"{% endif %} required name="phone" id="phone" class="form-control " placeholder="رقم الهاتف">
                                              <input type="hidden" name="order_id" value="{{ order.id  }}">
                                        </div>
                                        <div class="col-md-6 col-lg-4 col-sm-12">
                                   
                                              <label for="address">العنوان</label>
                                              <input type="text"  {% if order.adderess  %} value="{{ order.adderess }}"{% endif %}  required name="address" id="address" class="form-control " placeholder="العنوان">
                                        </div>
                                        <div class="col-md-6 col-lg-4 col-sm-12">
                                              <label for="gover">المحافظة</label>
                                              <select class="form-control " name="gover" required="">
                                                <option class="form-control "  value="" > </option>
                                                <option class="form-control " {% if  order.gover == 'b' %} selected {% endif %}  value="b" >بغداد</option>
                                                <option class="form-control " {% if  order.gover == 'm' %} selected {% endif %}  value="m">محافظات</option>
                                              </select>
                                        </div>
                                        <div class="col-md-6 col-lg-4 col-sm-12" >
                                           <br>
                                               <input type="submit" class="btn btn-primary btn-block btn-lg" value="تأكيد الطلب ">

                                        </div>
                                    
                                    </form>
                                </div>
                                   
                                   
                                      <div class="card-body p-0" style="display: block; margin-top:20px;">
                                          <div class="table-responsive" >
                                            <div style="padding-top: 15%;"><h3 style="margin-top: 36px; background-color: #eee; padding: 5px 26px; border-bottom: 1px solid #777;" >تفاصيل الطلب</h3></div>
                                              <table id="table" class="table m-0" >
                                                  <thead>
                                                    <tr>
                                                      <th>ت</th>
                                                      <th>التاريخ</th>
                                                      <th>عنوان الكتاب</th>
                                                      <th>العدد</th>
                                                      <th>سعر الواحد</th>
                                                      <th>مجموع السعر</th>
                                                      <th>حذف</th>
                                                    </tr>
                                                  </thead>
                                                  <tbody>
                                                      {% for book in order_books %}
                                                          <tr>                    
                                                              <td style="text-align:center;"> {{forloop.counter}} </td>
                                                              <td>     {{ book.order.order_date |date:"d /m/ Y"  }}  </td>
                                                              <td>    {{ book.book.title_book }}   </td>
                                                              <td>      {{ book.quantity }}     </td>
                                                              <td>      {{ book.price}}        </td>
                                                              <td>      {{ book.total_price }}    </td>
                                                              <td> <a class="btn btn-outline-danger" href="{% url 'orders:delete_from_cart' %}?orderDetails_id={{ book.id}}">حذف </a></td>
                                                          </tr>
                                                      {% endfor %}
                                              
                                                  </tbody>
                    
                                              </table>               
                                          </div>
                    
                                      </div>
                                      <div class="card-footer bg-text-dark border-success text-center">
                                            <span style="margin:0px 45px" id="val2">0000</span>                    
                                            <span style="margin:0px 45px" id="val">0000</span>
                                            <br>
                                              <div class="text-danger alert-danger "><span>لم يتم احتساب تكاليف التوصيل من ضمن الاسعار الموجودة</span>
                                              </div>
                                            <br>
                                            <br>
                                   
                                               <a class="btn btn-outline-danger" href="{% url 'orders:delete_cart' %}?order_id={{ order.id }}">حذف الطلب بالكامل </a>
                                      </div>
         
           
                               
         

                              {% else %}
                                       <h4>لا توجد سلة مشتريات في الوقت الحالي</h4>

                              {% endif %}    


                      </div>
                    </div>
                  </div>
                </div>
              </div>
            </div>
          </div>
          <!-- end:article -->

          <!-- begin:sidebar -->
            {% include 'books/partial/sidebar.html' %}
          <!-- end:sidebar -->
          
        </div>
      </div>
    </div>       
  
    <!-- end:content -->

  <script>

        var table = document.getElementById("table"), sumVal = 0,sumValcount=0;

        for(var i = 1; i < table.rows.length; i++)
        {
            sumVal = sumVal + parseInt(table.rows[i].cells[5].innerHTML);
            sumValcount = sumValcount + parseInt(table.rows[i].cells[3].innerHTML);
        }

        document.getElementById("val").innerHTML = "السعر الاجمالي = " + sumVal;
        document.getElementById("val2").innerHTML = "مجموع عدد الكتب  = " + sumValcount;


</script>




{% endblock content %}




{% block  domready %}
    <script>   
        $("#sendbutton").click(function(){
            document.getElementById("btn_close").click()           
            $.get("{% url 'orders:add_to_cart' %}",
            {
                book_id: $("#book_id").val(),
                quantity: $("#quantity").val(),
            },
            function(data){
                alert(data + Status );
                }
            );
        });
    </script>   

{% endblock domready %}